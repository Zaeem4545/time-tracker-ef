<header class="app-header">
  <div class="header-content">
    <div class="header-left">
      <button class="mobile-menu-btn" (click)="toggleSidebar()" *ngIf="isMobile()" aria-label="Toggle menu">
        <span>â˜°</span>
      </button>
      <div class="logo" (click)="goToDashboard()" style="cursor: pointer;">
        <img src="assets/new-logo.png" alt="ExpertFlow" class="logo-image" />
      </div>
    </div>
    <div class="header-right">
      <div class="user-info">
        <span class="user-name" (click)="viewProfile()">{{ getUserDisplayName() }}</span>
        <div class="user-avatar" (click)="viewProfile()" title="View profile">
          <img *ngIf="profilePictureUrl" [src]="profilePictureUrl" alt="Profile" class="avatar-image" />
          <span *ngIf="!profilePictureUrl">{{ getUserDisplayName().charAt(0) }}</span>
          <input type="file" #fileInput accept="image/*" (change)="onProfilePictureChange($event)"
            style="display: none;" />
        </div>
      </div>
      <div class="notifications-container">
        <button class="icon-btn" title="Notifications" (click)="toggleNotifications()">
          <span>ðŸ””</span>
          <span *ngIf="unreadCount > 0" class="notification-badge">{{ unreadCount }}</span>
        </button>
        <div class="dropdown notifications-dropdown" *ngIf="showNotifications">
          <div class="dropdown-content">
            <div class="notifications-header">
              <h4 style="margin: 0; font-size: 0.875rem; font-weight: 600; color: #333;">Notifications</h4>
              <button *ngIf="unreadCount > 0"
                (click)="markAllAsRead(); $event.stopPropagation(); $event.preventDefault()" class="mark-all-read-btn"
                style="background: none; border: none; color: #1976d2; cursor: pointer; font-size: 0.75rem; padding: 0.25rem 0.5rem; border-radius: 4px; transition: background 0.15s ease;"
                onmouseover="this.style.background='#f5f5f5'" onmouseout="this.style.background='none'">Mark all as
                read</button>
            </div>
            <div *ngIf="notifications.length === 0" class="dropdown-item no-notifications">
              No notifications
            </div>
            <div *ngFor="let notification of notifications" class="dropdown-item notification-item"
              [class.unread]="!notification.is_read" (click)="markAsRead(notification)">
              <div class="notification-content">
                <p class="notification-message">{{ notification.message }}</p>
                <span class="notification-time">{{ formatNotificationTime(notification.created_at) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="menu-container">
        <button class="icon-btn" title="Menu" (click)="toggleMenu()">
          <span>â‹®</span>
        </button>
        <div class="dropdown menu-dropdown" *ngIf="showMenu">
          <div class="dropdown-content">
            <div class="dropdown-item" (click)="openChangeProfilePicture()">
              Change Profile Picture
            </div>
            <div class="dropdown-item" (click)="openChangePasswordModal()">
              Change Password
            </div>
            <div class="dropdown-item" (click)="handleLogout()">
              Logout
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Change Password Modal -->
<div class="modal-overlay" *ngIf="showChangePasswordModal" (click)="closeChangePasswordModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Change Password</h3>
      <button class="modal-close" (click)="closeChangePasswordModal()">Ã—</button>
    </div>
    <div class="modal-body">
      <form (ngSubmit)="changePassword()">
        <div class="form-group">
          <label>Current Password *</label>
          <input type="password" [(ngModel)]="passwordData.currentPassword" name="currentPassword" required
            class="form-input" />
        </div>
        <div class="form-group">
          <label>New Password *</label>
          <input type="password" [(ngModel)]="passwordData.newPassword" name="newPassword" required
            class="form-input" />
        </div>
        <div class="form-group">
          <label>Re-enter New Password *</label>
          <input type="password" [(ngModel)]="passwordData.confirmPassword" name="confirmPassword" required
            class="form-input" />
          <div *ngIf="passwordMismatch" class="error-message">Passwords do not match</div>
        </div>
        <div *ngIf="passwordError" class="error-message">{{ passwordError }}</div>
        <div class="modal-footer">
          <button type="button" class="btn-cancel" (click)="closeChangePasswordModal()">Cancel</button>
          <button type="submit" class="btn-primary">Change Password</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Profile View Modal -->
<div class="modal-overlay" *ngIf="showProfileViewModal" (click)="closeProfileViewModal()">
  <div class="modal-content profile-view-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>My Profile</h3>
      <button class="modal-close" (click)="closeProfileViewModal()">Ã—</button>
    </div>
    <div class="modal-body profile-view-body">
      <div class="profile-picture-container">
        <div class="profile-picture-large">
          <img *ngIf="profilePictureUrl" [src]="profilePictureUrl" alt="Profile" class="profile-image-large" />
          <div *ngIf="!profilePictureUrl" class="profile-initial-large">{{ getUserDisplayName().charAt(0) }}</div>
        </div>
      </div>
      <div class="profile-info">
        <div class="profile-info-item">
          <label>Name</label>
          <div class="profile-info-value">{{ getUserDisplayName() }}</div>
        </div>
        <div class="profile-info-item">
          <label>Email</label>
          <div class="profile-info-value">{{ auth.getEmail() || 'N/A' }}</div>
        </div>
        <div class="profile-info-item">
          <label>Role</label>
          <div class="profile-info-value">{{ auth.getRole() || 'N/A' }}</div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn-primary" (click)="openChangeProfilePicture()">Change Profile Picture</button>
      <button type="button" class="btn-cancel" (click)="closeProfileViewModal()">Close</button>
    </div>
  </div>
</div>